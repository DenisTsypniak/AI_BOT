{% extends "base.html" %}

{% block title %}–ü–∞–º'—è—Ç—å - Live Role Bot{% endblock %}

{% block content %}
<style>
    .memory-nav {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 12px;
    }
    .memory-section {
        display: grid;
        gap: 12px;
    }
    .memory-section + .memory-section {
        margin-top: 6px;
    }
    .memory-heading {
        display: flex;
        justify-content: space-between;
        align-items: end;
        gap: 10px;
        flex-wrap: wrap;
    }
    .memory-sub {
        color: var(--text-muted);
        font-size: .84rem;
        margin: 0;
    }
    .fact-key {
        font-family: "Cascadia Mono", "Cascadia Code", Consolas, monospace;
        color: var(--accent);
        font-size: .82rem;
        word-break: break-word;
    }
    .importance-high { color: #f87171; }
    .importance-mid { color: #fbbf24; }
    .importance-low { color: #34d399; }
</style>

<div class="stack">
    <section class="page-header">
        <h1 class="page-title">üß† –í–∏—Ç—è–≥–Ω—É—Ç–∞ –ø–∞–º'—è—Ç—å</h1>
        <p class="page-description">–î–æ–≤–≥–æ—Ç—Ä–∏–≤–∞–ª—ñ —Ñ–∞–∫—Ç–∏ –π –µ–ø—ñ–∑–æ–¥–∏, —è–∫—ñ —Å–∏—Å—Ç–µ–º–∞ –≤–∏—Ç—è–≥–Ω—É–ª–∞ –∑ —Ä–æ–∑–º–æ–≤. –¶–µ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏–π –∑—Ä—ñ–∑ –ø–∞–º'—è—Ç—ñ, –∞ –Ω–µ –ø–æ–≤–Ω–∞ —Å–∏—Ä–∏–π –∂—É—Ä–Ω–∞–ª.</p>
        <div class="memory-nav">
            <a href="/memory/provenance" class="btn primary">–ü–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ (Provenance)</a>
            <a href="/memory/extractor" class="btn">–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Extractor</a>
            <a href="/persona/card" class="btn">–û—Å–æ–±–∏—Å—Ç—ñ—Å—Ç—å –õ—ñ–∑–∏</a>
            <a href="/persona/memory" class="btn">–ü–∞–º'—è—Ç—å –ø–µ—Ä—Å–æ–Ω–∏</a>
        </div>
    </section>

    <section class="memory-section">
        <div class="memory-heading">
            <div>
                <h2 class="section-title">üé¨ –ï–ø—ñ–∑–æ–¥–∏—á–Ω–∞ –ø–∞–º'—è—Ç—å</h2>
                <p class="memory-sub">–ü–æ–¥—ñ—ó —Ç–∞ —Å—Ü–µ–Ω–∏, —è–∫—ñ –º–æ–∂—É—Ç—å –≤–ø–ª–∏–≤–∞—Ç–∏ –Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫—É, summaries —ñ long-term context.</p>
            </div>
            <span class="pill">–ï–ø—ñ–∑–æ–¥—ñ–≤ <strong>{{ episodes|length }}</strong></span>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ó–∞–≥–æ–ª–æ–≤–æ–∫ / —Ç–∏–ø</th>
                        <th>–ö–æ—Ä–æ—Ç–∫–∏–π –∑–º—ñ—Å—Ç</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–í–∞–∂–ª–∏–≤—ñ—Å—Ç—å</th>
                        <th>–û–Ω–æ–≤–ª–µ–Ω–æ</th>
                        <th>–î—ñ—ó</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ep in episodes %}
                    <tr>
                        <td class="mono text-muted">#{{ ep.episode_id }}</td>
                        <td>
                            <div class="stack-sm" style="gap:5px;">
                                <strong>{{ ep.title }}</strong>
                                <span class="badge">{{ ep.episode_type }}</span>
                            </div>
                        </td>
                        <td class="text-wrap text-muted" style="font-size:.9rem; max-width: 520px;">{{ ep.summary }}</td>
                        <td>
                            {% if ep.status == 'confirmed' %}
                            <span class="badge green">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ</span>
                            {% elif ep.status == 'candidate' %}
                            <span class="badge yellow">–ö–∞–Ω–¥–∏–¥–∞—Ç</span>
                            {% else %}
                            <span class="badge">{{ ep.status }}</span>
                            {% endif %}
                        </td>
                        <td class="mono font-weight-bold {% if ep.importance > 0.7 %}importance-high{% elif ep.importance > 0.4 %}importance-mid{% else %}importance-low{% endif %}">
                            {{"%.2f"|format(ep.importance)}}
                        </td>
                        <td class="text-muted" style="font-size:.84rem;">{{ ep.updated_at|kyiv_time }}</td>
                        <td>
                            <a href="/memory/episodes/{{ ep.episode_id }}" class="btn" style="padding:6px 10px; font-size:.82rem;">–î–µ—Ç–∞–ª—ñ</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="7"><div class="empty-state">–ï–ø—ñ–∑–æ–¥—ñ–≤ —â–µ –Ω–µ –∑–∞–ø–∏—Å–∞–Ω–æ.</div></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>

    <section class="memory-section">
        <div class="memory-heading">
            <div>
                <h2 class="section-title">üë§ –§–∞–∫—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h2>
                <p class="memory-sub">–ê–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ user facts, –≤–∏—Ç—è–≥–Ω—É—Ç—ñ –∑ –¥—ñ–∞–ª–æ–≥—ñ–≤. –¶—ñ —Ñ–∞–∫—Ç–∏ –º–æ–∂—É—Ç—å –ø–æ—Ç—Ä–∞–ø–ª—è—Ç–∏ —É –∫–∞—Ä—Ç–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —ñ –≤ prompt-–ø–∞–º'—è—Ç—å.</p>
            </div>
            <span class="pill">–§–∞–∫—Ç—ñ–≤ <strong>{{ facts|length }}</strong></span>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</th>
                        <th>–ö–ª—é—á —Ñ–∞–∫—Ç—É</th>
                        <th>–ó–Ω–∞—á–µ–Ω–Ω—è</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–í–∞–∂–ª–∏–≤—ñ—Å—Ç—å</th>
                        <th>–û–Ω–æ–≤–ª–µ–Ω–æ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for fact in facts %}
                    <tr>
                        <td>
                            <div class="stack-sm" style="gap:4px;">
                                <strong>{{ fact.discord_username or '–ù–µ–≤—ñ–¥–æ–º–æ' }}</strong>
                                <span class="mono text-muted" style="font-size:.76rem;">{{ fact.user_id }}</span>
                            </div>
                        </td>
                        <td><div class="fact-key">{{ fact.fact_key }}</div></td>
                        <td class="text-wrap" style="max-width: 420px;">
                            {{ fact.fact_value }}
                            {% if fact.pinned %}
                            <span title="–ó–∞–∫—Ä—ñ–ø–ª–µ–Ω–∏–π —Ñ–∞–∫—Ç" style="cursor: help;">üìå</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if fact.status == 'active' %}
                            <span class="badge green">–ê–∫—Ç–∏–≤–Ω–∏–π</span>
                            {% elif fact.status == 'recalled' %}
                            <span class="badge blue">–ó–≥–∞–¥–∞–Ω–∏–π</span>
                            {% else %}
                            <span class="badge">{{ fact.status }}</span>
                            {% endif %}
                        </td>
                        <td class="mono font-weight-bold {% if fact.importance > 0.7 %}importance-high{% elif fact.importance > 0.4 %}importance-mid{% else %}importance-low{% endif %}">
                            {{"%.2f"|format(fact.importance)}}
                        </td>
                        <td class="text-muted" style="font-size:.84rem;">{{ fact.updated_at|kyiv_time }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6"><div class="empty-state">–§–∞–∫—Ç–∏ —â–µ –Ω–µ –≤–∏—Ç—è–≥–Ω—É—Ç–æ.</div></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
</div>
{% endblock %}

